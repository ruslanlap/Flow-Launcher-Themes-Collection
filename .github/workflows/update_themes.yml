name: üß† Weekly Flow Launcher Theme Sync

on:
  schedule:
    - cron: '0 0 * * 0'  # 00:00 UTC —â–æ–Ω–µ–¥—ñ–ª—ñ (03:00 –∑–∞ –ö–∏—î–≤–æ–º –ø—ñ–¥ —á–∞—Å EEST)
  workflow_dispatch:
  push:
    branches: [master]

# –ù–µ –∑–∞–ø—É—Å–∫–∞–π –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ —Å–∏–Ω–∫–∏
concurrency:
  group: theme-sync-${{ github.ref }}
  cancel-in-progress: true

# –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –≥–ª–æ–±–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∞; –±—ñ–ª—å—à—ñ ‚Äî –ª–∏—à–µ —Ç–∞–º, –¥–µ —Ç—Ä–µ–±–∞
permissions:
  contents: read
  pull-requests: write

jobs:
  update:
    name: üîÑ Fetch & Update Themes
    runs-on: ubuntu-latest
    permissions:
      contents: write        # –¥–ª—è commit —É –≥—ñ–ª–∫—É PR
      pull-requests: write   # –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è PR
    env:
      PYTHONUNBUFFERED: '1'
      # GITHUB_TOKEN –≤–∂–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ; —è–∫—â–æ –∫–æ–ª–∏—Å—å —Ç—Ä–µ–±–∞ PAT (–Ω–∞–ø—Ä. –∫—Ä–æ—Å-—Ä–µ–ø–æ) ‚Äî
      # –¥–æ–¥–∞–π —Å–µ–∫—Ä–µ—Ç PAT_TOKEN —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π –π–æ–≥–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∞ —è–∫ fallback.
    steps:
      - name: üì¶ Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: üêç Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'

      - name: üì• Install deps
        run: |
          python -m pip install -U pip
          python -m pip install requests

      - name: üì° Run Theme Sync Script
        env:
          GITHUB_TOKEN: ${{ github.token }}
          PAT_TOKEN: ${{ secrets.PAT_TOKEN }}   # –æ–ø—Ü—ñ–π–Ω–æ; —è–∫—â–æ –Ω–µ –∑–∞–¥–∞–Ω–∏–π ‚Äî —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ—Å—Ç–æ —ñ–≥–Ω–æ—Ä—É—î
        run: python update_themes.py

      # –°—Ç–≤–æ—Ä—é—î–º–æ PR –ª–∏—à–µ —è–∫—â–æ —î —Ä–µ–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–∏ ‚Äî action —Å–∞–º —Ü–µ –≤–∏–∑–Ω–∞—á–∏—Ç—å
      - name: üì¨ Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          # –Ø–∫—â–æ –¥—É–∂–µ —Ç—Ä–µ–±–∞ PAT: —Ä–æ–∑–∫–æ–º–µ–Ω—Ç—É–π –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—è–¥–æ–∫
          # token: ${{ secrets.PAT_TOKEN }}
          commit-message: "üßµ Auto-update themes & README ‚ú®"
          title: "chore(theme-sync): weekly auto-update"
          body: |
            Automated weekly sync.
            - Event: ${{ github.event_name }}
            - Run: ${{ github.run_id }}
          branch: chore/theme-sync
          branch-suffix: timestamp
          delete-branch: true
          signoff: true
          committer: github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>
          author: github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>
          labels: |
            chore
            automated
