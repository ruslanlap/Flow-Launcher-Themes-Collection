name: üß† Weekly Flow Launcher Theme Sync

on:
  schedule:
    - cron: '0 0 * * 0'  # ‚è∞ –©–æ–Ω–µ–¥—ñ–ª—ñ –æ 00:00 UTC
  workflow_dispatch:     # üñê –†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫

jobs:
  update:
    name: üîÑ Fetch & Update Themes
    runs-on: ubuntu-latest
    permissions:
      contents: write  # üîë –ù–µ–æ–±—Ö—ñ–¥–Ω—ñ –ø—Ä–∞–≤–∞

    steps:
      - name: üì¶ Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT_TOKEN }}  # üîê –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ PAT
          fetch-depth: 0
          persist-credentials: true

      - name: üêç Set Up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: üì• Install Dependencies
        run: pip install requests

      - name: üì° Run Theme Sync Script and Commit Changes
        env:
          PAT_TOKEN: ${{ secrets.PAT_TOKEN }}  # üóùÔ∏è –í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π —Ç–æ–∫–µ–Ω
        run: |
          # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Git
          git config --local user.name "Theme Sync Bot ü§ñ"
          git config --local user.email "themes-bot@flowlauncher.dev"
          
          # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ PAT
          git remote set-url origin https://x-access-token:${PAT_TOKEN}@github.com/${{ github.repository }}.git
          
          # –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
          python update_themes.py
          
          # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–º—ñ–Ω
          if git diff --name-only | grep -q "README.md"; then
            # –ö–æ–º–º—ñ—Ç —Ç–∞ –ø—É—à
            git add README.md
            git commit -m "üßµ Auto-update README with new themes ‚ú®"
            git push origin HEAD:${GITHUB_REF#refs/heads/}
          else
            echo "‚û∞ No changes to commit"
          fi